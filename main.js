(()=>{"use strict";var e=function(e){return e.target.classList.toggle("card__like-button_is-active")};function t(e,t,n,o,r,c,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__image"),l=i.querySelector(".card__title"),p=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-count"),_=e.owner._id,f=e._id;return a.src=e.link,l.textContent=e.name,a.alt=e.name,d.textContent="number"==typeof e.likes?e.likes.length:0,a.addEventListener("click",(function(){r(e.link,e.name,e.name)})),s.addEventListener("click",(function(e){o(e)})),t===_?(p.style.visibility="visible",p.addEventListener("click",(function(){n(f).then((function(){i.remove()}))}))):p.remove(),i}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function o(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&(document.querySelector(".popup_is-opened"),o())}function c(e){e.currentTarget===e.target&&o(e.currentTarget)}function u(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var i=function(e,t,n){var o=e.querySelector(".".concat(t.id,".popup__input-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function a(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);o.classList.add(t.inactiveButtonClass),n.forEach((function(r){i(e,r,t),u(n,o,t)}))}var l={url:"https://nomoreparties.co/v1/".concat("wff-cohort-28"),headers:{authorization:"00fd9f92-5b54-4d51-b39a-ce0e5928685c","Content-Type":"application/json"}};function p(e){void 0===e.status?console.error("Неизвестная ошибка",e):console.error("Ошибка ".concat(e.status))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o={method:t,headers:l.headers};return n&&(o.body=JSON.stringify(n)),fetch("".concat(l.url,"/").concat(e),o).then((function(e){return e.ok?e.json():Promise.reject(e)})).catch(p)}function d(e){return s("cards/".concat(e),"DELETE")}var _,f,m=document.querySelectorAll(".popup"),v=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),S=document.querySelector(".popup_type_edit"),q=document.forms["edit-profile"],b=q.querySelector(".popup__button"),E=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),h=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_description"),g=(document.querySelectorAll(".popup__close"),document.querySelector(".profile__add-button")),x=document.querySelector(".popup_type_new-card"),A=document.forms["new-place"],T=A.querySelector(".popup__input_type_card-name"),w=A.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),D=B.querySelector(".popup__image"),P=B.querySelector(".popup__caption"),j=document.querySelector(".popup_type_edit-avatar"),M=document.forms["edit-avatar"],G=M.querySelector(".popup__button"),H=M.querySelector(".popup__input_type_avatar"),N=document.querySelector(".profile__image-container"),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function V(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function z(e,t,o){D.src=e,D.alt=t,P.textContent=o,n(B)}Promise.all([s("users/me","GET"),s("cards","GET")]).then((function(n){var o=n[0];_=o._id;var r=n[1];!function(e){E.textContent=e.name,C.textContent=e.about,L.style.backgroundImage="url(".concat(e.avatar,")")}(o),r.forEach((function(n){v.append(t(n,_,d,e,z))}))})).catch(p),m.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",c),e.querySelector(".popup__close").addEventListener("click",o)})),N.addEventListener("click",(function(){return n(j)})),g.addEventListener("click",(function(){return n(x)})),y.addEventListener("click",(function(){a(q,O),q.elements.name.value=E.textContent,q.elements.description.value=C.textContent,n(S)})),q.addEventListener("submit",(function(e){var t,n;e.preventDefault(),V(!0,b),(t=h.value,n=k.value,s("users/me","PATCH",{name:t,about:n})).then((function(e){E.textContent=e.name,C.textContent=e.about,a(q,O),o()})).finally((function(){V(!1,b)}))})),M.addEventListener("submit",(function(e){var t;e.preventDefault(),V(!0,G),(t=H.value,s("users/me/avatar","PATCH",{avatar:t})).then((function(e){L.src=e.avatar,a(M,O),o()})).finally((function(){V(!1,G)}))})),A.addEventListener("submit",(function(n){var r,c;n.preventDefault(),V(!0,g),(r=T.value,c=w.value,s("cards","POST",{name:r,link:c})).then((function(n){var r=t(n,n.owner._id,d,e,z);v.prepend(r),o(),A.reset(),a(A,O)})).catch(p).finally((function(){V(!1,g)}))})),f=O,Array.from(document.querySelectorAll(f.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);u(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,".popup__input-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),u(n,o,t)}))}))}(e,f)}))})();