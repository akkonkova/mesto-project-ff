(()=>{"use strict";var e={url:"https://nomoreparties.co/v1/".concat("wff-cohort-28"),headers:{authorization:"00fd9f92-5b54-4d51-b39a-ce0e5928685c","Content-Type":"application/json"}};function t(e){void 0===e.status?console.error("Неизвестная ошибка",e):console.error("Ошибка ".concat(e.status))}function n(n,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:o,headers:e.headers};return r&&(c.body=JSON.stringify(r)),fetch("".concat(e.url,"/").concat(n),c).then((function(e){return e.ok?e.json():Promise.reject(e)})).catch(t)}function o(e){return n("cards/likes/".concat(e),"PUT")}function r(e){return n("cards/likes/".concat(e),"DELETE")}function c(e,t){var o;(o=t,n("cards/".concat(o),"DELETE")).then((function(){e.remove()})).catch((function(e){return console.error("Ошибка при удалении карточки ".concat(e.status))}))}function u(e,t){return e.likes.some((function(e){return e._id===t}))}function i(e,t,n,c,i){(u(e,c)?r:o)(n).then((function(n){var o=n.likes;e.likes=o;var r=u(e,c);t.classList.toggle("card__like-button_is-active",r),i.textContent=o.length}))}function a(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),p=c.querySelector(".card__like-count"),d=e.owner._id,_=e._id;i.src=e.link,a.textContent=e.name,i.alt=e.name,p.textContent=e.likes.length||0;var f=u(e,t);return s.classList.toggle("card__like-button_is-active",f),s.addEventListener("click",(function(){o(e,s,_,t,p)})),t===d?(l.style.visibility="visible",l.addEventListener("click",(function(){return n(c,_)}))):l.remove(),i.addEventListener("click",(function(){r(e.link,e.name,e.name)})),c}function l(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",p)}function s(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened"),document.removeEventListener("keydown",p)}function p(e){"Escape"===e.key&&(document.querySelector(".popup_is-opened"),s())}function d(e){e.currentTarget===e.target&&s(e.currentTarget)}function _(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var f=function(e,t,n){var o=e.querySelector(".".concat(t.id,".popup__input-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);o.classList.add(t.inactiveButtonClass),n.forEach((function(r){f(e,r,t),_(n,o,t)}))}var v,y,S=document.querySelectorAll(".popup"),q=document.querySelector(".places__list"),E=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),L=document.forms["edit-profile"],h=L.querySelector(".popup__button"),C=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),x=document.querySelector(".popup__input_type_name"),T=document.querySelector(".popup__input_type_description"),A=(document.querySelectorAll(".popup__close"),document.querySelector(".profile__add-button")),w=document.querySelector(".popup_type_new-card"),B=document.forms["new-place"],D=B.querySelector(".popup__input_type_card-name"),P=B.querySelector(".popup__input_type_url"),j=document.querySelector(".popup_type_image"),M=j.querySelector(".popup__image"),G=j.querySelector(".popup__caption"),H=document.querySelector(".popup_type_edit-avatar"),N=document.forms["edit-avatar"],O=N.querySelector(".popup__button"),V=N.querySelector(".popup__input_type_avatar"),z=document.querySelector(".profile__image-container"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function J(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function U(e,t,n){M.src=e,M.alt=t,G.textContent=n,l(j)}Promise.all([n("users/me","GET"),n("cards","GET")]).then((function(e){var t=e[0];v=t._id;var n=e[1];!function(e){C.textContent=e.name,k.textContent=e.about,g.style.backgroundImage="url(".concat(e.avatar,")")}(t),n.forEach((function(e){q.append(a(e,v,c,i,U))}))})).catch(t),S.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",d),e.querySelector(".popup__close").addEventListener("click",s)})),z.addEventListener("click",(function(){m(H,I),N.reset(),l(H)})),A.addEventListener("click",(function(){m(w,I),B.reset(),l(w)})),E.addEventListener("click",(function(){m(L,I),L.elements.name.value=C.textContent,L.elements.description.value=k.textContent,l(b)})),L.addEventListener("submit",(function(e){var t,o;e.preventDefault(),J(!0,h),(t=x.value,o=T.value,n("users/me","PATCH",{name:t,about:o})).then((function(e){C.textContent=e.name,k.textContent=e.about,m(L,I),s()})).finally((function(){J(!1,h)}))})),N.addEventListener("submit",(function(e){var t;e.preventDefault(),J(!0,O),(t=V.value,n("users/me/avatar","PATCH",{avatar:t})).then((function(e){g.src=e.avatar,m(N,I),s()})).finally((function(){J(!1,O)}))})),B.addEventListener("submit",(function(e){var o,r;e.preventDefault(),J(!0,A),(o=D.value,r=P.value,n("cards","POST",{name:o,link:r})).then((function(e){var t=a(e,e.owner._id,c,i,U);q.prepend(t),s(),B.reset(),m(B,I)})).catch(t).finally((function(){J(!1,A)}))})),y=I,Array.from(document.querySelectorAll(y.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);_(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,".popup__input-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),_(n,o,t)}))}))}(e,y)}))})();